<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Thin → Win10 Scrollbar (hover on scrollbar)</title>
  <style>
    /* Base */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html,
    body {
      height: 100%;
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #f3f3f3;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 28px;
    }

    /* Container */
    .scroll-wrapper {
      width: 760px;
      height: 460px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
      position: relative;
      overflow: hidden;
      /* content scrolling inside .scroll-content */
    }

    /* Content area: hide native scrollbars (we use custom) */
    .scroll-content {
      height: 100%;
      overflow-y: auto;
      padding: 24px;
      line-height: 1.75;
      color: #222;
      scrollbar-width: none;
      /* Firefox */
      -ms-overflow-style: none;
      /* IE/Edge */
    }

    .scroll-content::-webkit-scrollbar {
      display: none;
    }

    /* Custom scrollbar container (always present) */
    .custom-scrollbar {
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      /* DEFAULT thin line width */
      transition: width 220ms cubic-bezier(.2, .8, .2, 1), background 160ms ease;
      z-index: 40;
      display: block;
      pointer-events: auto;
      /* we will forward wheel events when needed */
    }

    /* Track (full height minus arrow zones) */
    .scrollbar-track {
      position: absolute;
      right: 0;
      top: 17px;
      bottom: 17px;
      width: 100%;
      background: #f5f5f5;
      /* visible even in thin state */
      border-radius: 10px;
      overflow: visible;
      transition: background 160ms ease;
    }

    /* Thumb (visible as darker portion of thin line) */
    .scrollbar-thumb {
      position: absolute;
      right: 0;
      width: 100%;
      background: #555;
      /* thin-state thumb color */
      border-radius: 10px;
      min-height: 40px;
      cursor: grab;
      transition: background 140ms ease, height 120ms ease, top 120ms ease;
      will-change: top, height;
    }

    .scrollbar-thumb:active {
      cursor: grabbing;
    }

    /* Arrow buttons (hidden by default via opacity/transform but outside layout) */
    .scrollbar-arrow {
      position: absolute;
      right: 0;
      width: 17px;
      height: 17px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f0f0f0;
      /* border-radius: 3px; */
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
      color: #656565;
      opacity: 0;
      transform: translateX(6px);
      transition: opacity 220ms cubic-bezier(.2, .8, .2, 1), transform 220ms cubic-bezier(.2, .8, .2, 1), color 120ms ease;
      pointer-events: none;
      /* enabled when expanded */
      z-index: 45;
      user-select: none;
    }

    .scrollbar-arrow:active {
      background: #cccccc;
      color: #005a9e;
    }

    .scrollbar-arrow:hover {
      color: #0078d7;
    }

    .scrollbar-arrow-up {
      top: 0;
      border-top-left-radius: 6px;
      border-top-right-radius: 6px;
    }

    .scrollbar-arrow-down {
      bottom: 0;
      border-bottom-left-radius: 6px;
      border-bottom-right-radius: 6px;
    }

    .scrollbar-arrow svg {
      width: 9px;
      height: 9px;
      stroke: currentColor;
      stroke-width: 2.5;
      stroke-linecap: round;
      stroke-linejoin: round;
      fill: none;
    }

    /* EXPANDED state (Win10 look) */
    .custom-scrollbar.expanded {
      width: 17px;
      border-radius: 0;
      background: transparent;
    }

    .custom-scrollbar.expanded .scrollbar-track {
      background: #f0f0f0;
    }

    .custom-scrollbar.expanded .scrollbar-thumb {
      background: #c2c3c9;
    }

    .custom-scrollbar.expanded .scrollbar-thumb:hover {
      background: #86868b;
    }

    .custom-scrollbar.expanded .scrollbar-arrow {
      opacity: 1;
      transform: translateX(0);
      pointer-events: auto;
    }

    /* Thumb active color when dragging */
    .custom-scrollbar.expanded .scrollbar-thumb.dragging {
      background: #555;
    }

    /* Accessibility focus outlines for arrows */
    .scrollbar-arrow:focus {
      outline: 2px solid rgba(0, 120, 215, 0.14);
      outline-offset: 2px;
    }

    /* Respect very small screens: hide overlay feature */
    @media (max-width:520px) {
      .custom-scrollbar {
        display: none;
      }

      .scroll-content {
        padding-right: 12px;
      }
    }
  </style>
</head>

<body>
  <div class="scroll-wrapper" id="scrollWrapper">
    <div class="scroll-content" id="scrollContent" tabindex="0" aria-label="Scrollable content">
      <!-- Sample content -->
      <h2>Demo: Thin → Windows-style Scrollbar</h2>
      <p>
        Default shows only a thin line (4px). Hover that thin line (not the entire content) — after a short delay it
        expands
        into a Windows 10 style scrollbar with arrows, track and a larger thumb. On mouse leave it smoothly collapses
        back.
      </p>
      <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque vehicula lacus et risus luctus, vitae
        iaculis dolor tincidunt.
        Integer facilisis velit at augue gravida, ac iaculis lorem dapibus. Vestibulum tristique, lorem non hendrerit
        faucibus, justo magna laoreet urna,
        nec pulvinar lectus ipsum vel lorem. Fusce elementum, lorem nec volutpat tincidunt, augue lorem faucibus justo,
        quis efficitur augue orci in odio.
      </p>
      <p>
        Cras sed velit eu leo tristique ultricies. Donec vitae sem augue. Curabitur vitae gravida risus. Suspendisse
        potenti. Integer id neque sed nibh placerat posuere.
      </p>
      <p>
        (Repeat some paragraphs to create scrollable content)
      </p>
      <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque vehicula lacus et risus luctus, vitae
        iaculis dolor tincidunt.
        Integer facilisis velit at augue gravida, ac iaculis lorem dapibus. Vestibulum tristique, lorem non hendrerit
        faucibus, justo magna laoreet urna,
        nec pulvinar lectus ipsum vel lorem. Fusce elementum, lorem nec volutpat tincidunt, augue lorem faucibus justo,
        quis efficitur augue orci in odio.
      </p>
      <p>
        Cras sed velit eu leo tristique ultricies. Donec vitae sem augue. Curabitur vitae gravida risus. Suspendisse
        potenti. Integer id neque sed nibh placerat posuere.
      </p>
      <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque vehicula lacus et risus luctus, vitae
        iaculis dolor tincidunt.
        Integer facilisis velit at augue gravida, ac iaculis lorem dapibus. Vestibulum tristique, lorem non hendrerit
        faucibus, justo magna laoreet urna,
        nec pulvinar lectus ipsum vel lorem. Fusce elementum, lorem nec volutpat tincidunt, augue lorem faucibus justo,
        quis efficitur augue orci in odio.
      </p>
      <p>
        End of demo content.
      </p>
    </div>

    <!-- Custom scrollbar overlay -->
    <div class="custom-scrollbar" id="customScrollbar" aria-hidden="false">
      <div class="scrollbar-arrow scrollbar-arrow-up" id="arrowUp" role="button" tabindex="0" aria-label="Scroll up">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M4 16L12 8L20 16"></path>
        </svg>
      </div>

      <div class="scrollbar-track" id="scrollbarTrack" aria-hidden="true">
        <div class="scrollbar-thumb" id="scrollbarThumb" role="slider" aria-orientation="vertical" tabindex="0"></div>
      </div>

      <div class="scrollbar-arrow scrollbar-arrow-down" id="arrowDown" role="button" tabindex="0"
        aria-label="Scroll down">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M4 8L12 16L20 8"></path>
        </svg>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const wrapper = document.getElementById('scrollWrapper');
      const content = document.getElementById('scrollContent');
      const customScrollbar = document.getElementById('customScrollbar');
      const track = document.getElementById('scrollbarTrack');
      const thumb = document.getElementById('scrollbarThumb');
      const arrowUp = document.getElementById('arrowUp');
      const arrowDown = document.getElementById('arrowDown');

      // timing settings
      const HOVER_IN_DELAY = 200;  // ms before expanding after pointer enters the thin line
      const HOVER_OUT_DELAY = 500; // ms before collapsing after leaving scrollbar
      const ARROW_STEP = 80;       // px per arrow step (click)
      const ARROW_HOLD_INTERVAL = 140; // ms for continuous scroll when holding arrow

      let hoverInTimer = null;
      let hoverOutTimer = null;
      let isExpanded = false;

      // Thumb dragging state
      let dragging = false;
      let dragStartY = 0;
      let scrollStart = 0;

      // Arrow hold interval ref
      let arrowInterval = null;

      // Utility: update thumb size & position
      function updateThumb() {
        const scrollHeight = content.scrollHeight;
        const clientHeight = content.clientHeight;

        if (scrollHeight <= clientHeight) {
          thumb.style.display = 'none';
          return;
        } else {
          thumb.style.display = 'block';
        }

        const trackRect = track.getBoundingClientRect();
        const trackHeight = Math.max(0, trackRect.height);
        const thumbHeight = Math.max((clientHeight / scrollHeight) * trackHeight, 40);
        const maxTop = trackHeight - thumbHeight;
        const scrollTop = content.scrollTop;
        const top = (scrollTop / (scrollHeight - clientHeight)) * maxTop;

        thumb.style.height = thumbHeight + 'px';
        thumb.style.top = (top) + 'px';
      }

      // Initial calc
      updateThumb();

      // Keep in sync when content scrolls or resizes
      content.addEventListener('scroll', updateThumb);
      window.addEventListener('resize', updateThumb);

      // Show expanded state after hover delay (pointerenter on the *scrollbar* only)
      customScrollbar.addEventListener('pointerenter', (e) => {
        // ignore non-primary (e.g., pen buttons) if needed
        window.clearTimeout(hoverOutTimer);
        hoverInTimer = window.setTimeout(() => {
          customScrollbar.classList.add('expanded');
          isExpanded = true;
          thumb.style.borderRadius = '0';
          updateThumb();
        }, HOVER_IN_DELAY);
      });

      // Collapse after leaving scrollbar area (with longer delay)
      customScrollbar.addEventListener('pointerleave', () => {
        window.clearTimeout(hoverInTimer);
        hoverOutTimer = window.setTimeout(() => {
          customScrollbar.classList.remove('expanded');
          isExpanded = false;
        }, HOVER_OUT_DELAY);
      });

      // Forward wheel events that occur over the custom scrollbar to the content
      customScrollbar.addEventListener('wheel', (e) => {
        // Prevent default so the page doesn't also scroll; we handle content scroll explicitly
        e.preventDefault();
        content.scrollTop += e.deltaY;
      }, { passive: false });

      /* ---------- Thumb dragging (pointer events) ---------- */
      thumb.addEventListener('pointerdown', (e) => {
        dragging = true;
        dragStartY = e.clientY;
        scrollStart = content.scrollTop;
        thumb.classList.add('dragging');

        // capture pointer so we receive pointermove outside the thumb
        try { thumb.setPointerCapture(e.pointerId); } catch (err) { }
        // prevent text selection while dragging
        document.body.style.userSelect = 'none';
      });

      document.addEventListener('pointermove', (e) => {
        if (!dragging) return;
        const deltaY = e.clientY - dragStartY;
        const scrollHeight = content.scrollHeight;
        const clientHeight = content.clientHeight;
        const trackHeight = track.clientHeight;
        const thumbHeight = parseFloat(getComputedStyle(thumb).height) || 40;
        const maxThumbTop = Math.max(trackHeight - thumbHeight, 1);
        const ratio = (scrollHeight - clientHeight) / maxThumbTop;
        content.scrollTop = scrollStart + deltaY * ratio;
      });

      document.addEventListener('pointerup', (e) => {
        if (!dragging) return;
        dragging = false;
        thumb.classList.remove('dragging');
        try { thumb.releasePointerCapture && thumb.releasePointerCapture(e.pointerId); } catch (err) { }
        document.body.style.userSelect = '';
      });

      // Allow keyboard dragging / arrow control on the thumb (Home/End/PageUp/PageDown)
      thumb.addEventListener('keydown', (e) => {
        const key = e.key;
        if (key === 'PageDown') { e.preventDefault(); content.scrollBy({ top: content.clientHeight, behavior: 'smooth' }); }
        else if (key === 'PageUp') { e.preventDefault(); content.scrollBy({ top: -content.clientHeight, behavior: 'smooth' }); }
        else if (key === 'Home') { e.preventDefault(); content.scrollTo({ top: 0, behavior: 'smooth' }); }
        else if (key === 'End') { e.preventDefault(); content.scrollTo({ top: content.scrollHeight, behavior: 'smooth' }); }
      });

      /* ---------- Track click: page up/down ---------- */
      track.addEventListener('click', (e) => {
        // If clicked on thumb, ignore (thumb has its own pointer handlers)
        if (e.target === thumb) return;
        const rect = track.getBoundingClientRect();
        const clickY = e.clientY - rect.top;
        const thumbTop = parseFloat(thumb.style.top || 0);
        const thumbHeight = parseFloat(getComputedStyle(thumb).height || 40);

        if (clickY < thumbTop) {
          // page up
          content.scrollBy({ top: -content.clientHeight, behavior: 'smooth' });
        } else if (clickY > thumbTop + thumbHeight) {
          // page down
          content.scrollBy({ top: content.clientHeight, behavior: 'smooth' });
        }
      });

      /* ---------- Arrow behavior (click + hold) ---------- */
      function startArrowScrolling(direction) {
        // single step immediately
        content.scrollBy({ top: direction * ARROW_STEP, behavior: 'smooth' });

        // then continuous scrolling with 'auto' behavior for immediate movement
        if (arrowInterval) clearInterval(arrowInterval);
        arrowInterval = setInterval(() => {
          content.scrollBy({ top: direction * (ARROW_STEP / 2), behavior: 'auto' });
        }, ARROW_HOLD_INTERVAL);
      }
      function stopArrowScrolling() {
        if (arrowInterval) { clearInterval(arrowInterval); arrowInterval = null; }
      }

      // Up
      arrowUp.addEventListener('pointerdown', (e) => {
        e.preventDefault();
        startArrowScrolling(-1);
      });
      arrowUp.addEventListener('pointerup', stopArrowScrolling);
      arrowUp.addEventListener('pointerleave', stopArrowScrolling);
      arrowUp.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); content.scrollBy({ top: -ARROW_STEP, behavior: 'smooth' }); }
      });

      // Down
      arrowDown.addEventListener('pointerdown', (e) => {
        e.preventDefault();
        startArrowScrolling(1);
      });
      arrowDown.addEventListener('pointerup', stopArrowScrolling);
      arrowDown.addEventListener('pointerleave', stopArrowScrolling);
      arrowDown.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); content.scrollBy({ top: ARROW_STEP, behavior: 'smooth' }); }
      });

      /* ---------- Thumb hover color behavior when expanded ---------- */
      // CSS handles hover colors; JS ensures thumb updates on expand
      // Recalculate thumb immediately when expansion state changes
      const observer = new MutationObserver(() => updateThumb());
      observer.observe(customScrollbar, { attributes: true, attributeFilter: ['class'] });

      /* ---------- Accessibility & focus handling ---------- */
      // If keyboard focuses the arrows or thumb, show expanded state
      [arrowUp, arrowDown, thumb].forEach(el => {
        el.addEventListener('focus', () => {
          window.clearTimeout(hoverOutTimer);
          window.clearTimeout(hoverInTimer);
          customScrollbar.classList.add('expanded');
          isExpanded = true;
          updateThumb();
        });
        el.addEventListener('blur', () => {
          // collapse after out delay
          window.clearTimeout(hoverInTimer);
          hoverOutTimer = window.setTimeout(() => {
            customScrollbar.classList.remove('expanded');
            isExpanded = false;
          }, HOVER_OUT_DELAY);
        });
      });

      /* ---------- Edge-case protections ---------- */
      // If content changes height dynamically, recalc
      const resizeObserver = new ResizeObserver(updateThumb);
      resizeObserver.observe(content);

      // Ensure initial visibility of thin line even before mouse interactions
      // (thumb updated earlier)
    })();
  </script>
</body>

</html>